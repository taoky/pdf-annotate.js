!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.PDFAnnotate=e():t.PDFAnnotate=e()}(self,(()=>(()=>{"use strict";var t={187:t=>{var e,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function i(){i.init.call(this)}t.exports=i,t.exports.once=function(t,e){return new Promise((function(n,r){function o(n){t.removeListener(e,i),r(n)}function i(){"function"==typeof t.removeListener&&t.removeListener("error",o),n([].slice.call(arguments))}m(t,e,i,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&m(t,"error",e,{once:!0})}(t,o)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var a=10;function c(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function u(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function l(t,e,n,r){var o,i,a,l;if(c(n),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),a=i[e]),void 0===a)a=i[e]=n,++t._eventsCount;else if("function"==typeof a?a=i[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(o=u(t))>0&&a.length>o&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=a.length,l=s,console&&console.warn&&console.warn(l)}return t}function s(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=s.bind(r);return o.listener=n,r.wrapFn=o,o}function f(t,e,n){var r=t._events;if(void 0===r)return[];var o=r[e];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(o):y(o,o.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function m(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function o(i){r.once&&t.removeEventListener(e,o),n(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");a=t}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return u(this)},i.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var o="error"===t,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var u=i[t];if(void 0===u)return!1;if("function"==typeof u)r(u,this,e);else{var l=u.length,s=y(u,l);for(n=0;n<l;++n)r(s[n],this,e)}return!0},i.prototype.addListener=function(t,e){return l(this,t,e,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(t,e){return l(this,t,e,!0)},i.prototype.once=function(t,e){return c(e),this.on(t,d(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){return c(e),this.prependListener(t,d(this,t,e)),this},i.prototype.removeListener=function(t,e){var n,r,o,i,a;if(c(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===e||n[i].listener===e){a=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,o),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},i.prototype.listeners=function(t){return f(this,t,!0)},i.prototype.rawListeners=function(t){return f(this,t,!1)},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},i.prototype.listenerCount=p,i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return(()=>{function t(t){throw new Error(t+" is not implemented")}n.r(r);var e=n(187),o=n.n(e),i=/[A-Z]/g,a=["viewBox"];function c(t,e){Object.keys(e).forEach((function(n){t.setAttribute(function(t){return-1===a.indexOf(t)&&(t=t.replace(i,(function(t){return"-"+t.toLowerCase()}))),t}(n),e[n])}))}var u=/^([a-f0-9]{6}|[a-f0-9]{3})$/i;function l(t){return u.test(t)&&(t="#".concat(t)),t}var s=25;function d(t){var e=document.createElementNS("http://www.w3.org/2000/svg","rect");return c(e,{x:t.x,y:t.y,width:t.width,height:t.height}),e}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function p(t){var e=document.createElementNS("http://www.w3.org/2000/svg","text");c(e,{x:t.x,y:t.y,fill:l(t.color||"#000"),fontSize:t.size,transform:"rotate(".concat(t.rotation,")"),style:"white-space: pre"}),function(t,e){var n,r=(e||"").split("\n"),o=t.getAttribute("x"),i=Number(t.getAttribute("y")),a=Number(t.getAttribute("font-size")),c=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}(r);try{for(c.s();!(n=c.n()).done;){var u=n.value,l=document.createElementNS("http://www.w3.org/2000/svg","tspan");l.setAttribute("y",i.toString()),l.setAttribute("x",o),l.innerHTML=u,t.appendChild(l),i+=a}}catch(t){c.e(t)}finally{c.f()}}(e,t.content);var n=document.createElementNS("http://www.w3.org/2000/svg","g");return n.appendChild(e),n}function y(t,e,n){return[t[0],t[1],t[2],t[3],t[0]*e+t[2]*n+t[4],t[1]*e+t[3]*n+t[5]]}function m(t,e){e=e*Math.PI/180;var n=Math.cos(e),r=Math.sin(e);return[t[0]*n+t[2]*r,t[1]*n+t[3]*r,t[0]*-r+t[2]*n,t[1]*-r+t[3]*n,t[4],t[5]]}function h(t,e,n){return[t[0]*e,t[1]*e,t[2]*n,t[3]*n,t[4],t[5]]}function v(t,e,n){return{x:t,y:e,z:n}}function g(t,e,n){return{xcoord:t,ycoord:e,zcoord:n}}function b(t,e){return g(e.x-t.x,e.y-t.y,e.z-t.z)}function w(t,e){return v(t.x+e.xcoord,t.y+e.ycoord,t.z+e.zcoord)}function x(t,e){return g(t.xcoord*e,t.ycoord*e,t.zcoord*e)}function A(t){return Math.sqrt(Math.pow(t.xcoord,2)+Math.pow(t.ycoord,2)+Math.pow(t.zcoord,2))}function S(t){return x(t,-1)}function E(t){var e=A(t);return g(t.xcoord/e,t.ycoord/e,t.zcoord/e)}var I=/firefox/i.test(navigator.userAgent);function C(t){var e,n;switch(t.rotation%360){case 0:e=n=0;break;case 90:e=0,n=t.width/t.scale*-1;break;case 180:e=t.width/t.scale*-1,n=t.height/t.scale*-1;break;case 270:e=t.height/t.scale*-1,n=0}return{x:e,y:n}}function L(t,e){var n=C(e);if(t.setAttribute("transform","scale(".concat(e.scale,") rotate(").concat(e.rotation,") translate(").concat(n.x,", ").concat(n.y,")")),!I&&"svg"===t.nodeName.toLowerCase()){t.setAttribute("x",parseInt(t.getAttribute("x"),10)*e.scale),t.setAttribute("y",parseInt(t.getAttribute("y"),10)*e.scale);var r=parseInt(t.getAttribute("x",10)),o=parseInt(t.getAttribute("y",10)),i=parseInt(t.getAttribute("width"),10),a=parseInt(t.getAttribute("height"),10),c=t.querySelector("path"),u=c.parentNode;switch([t,u,c,t.querySelector("rect")].forEach((function(t){t.setAttribute("width",parseInt(t.getAttribute("width"),10)*e.scale),t.setAttribute("height",parseInt(t.getAttribute("height"),10)*e.scale)})),L(c,Object.assign({},e,{scale:1})),e.rotation%360){case 90:t.setAttribute("x",e.width-o-i),t.setAttribute("y",r),u.setAttribute("x",1),u.setAttribute("y",0);break;case 180:t.setAttribute("x",e.width-r-i),t.setAttribute("y",e.height-o-a),u.setAttribute("y",2);break;case 270:t.setAttribute("x",o),t.setAttribute("y",e.height-r-a),u.setAttribute("x",-1),u.setAttribute("y",0)}}return t}function k(t,e,n){var r,o,i;switch(n||(n=JSON.parse(t.getAttribute("data-pdf-annotate-viewport"))),e.type){case"area":case"highlight":r=function(t){if("highlight"===t.type){var e=document.createElementNS("http://www.w3.org/2000/svg","g");return c(e,{fill:l(t.color||"#ff0"),fillOpacity:.2}),t.rectangles.forEach((function(t){e.appendChild(d(t))})),e}var n=d(t);return c(n,{stroke:l(t.color||"#f00"),fill:"none"}),n}(e);break;case"circle":case"fillcircle":case"emptycircle":r=function(t){var e=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","circle");return c(e,{cx:t.cx,cy:t.cy,r:t.r}),e}(t),n=l(t.color||"#f00");return"circle"===t.type&&c(e,{stroke:n,fill:"none","stroke-width":5}),"emptycircle"===t.type&&c(e,{stroke:n,fill:"none","stroke-width":2}),"fillcircle"===t.type&&c(e,{stroke:n,fill:n,"stroke-width":5}),e}(e);break;case"strikeout":o=e,c(i=document.createElementNS("http://www.w3.org/2000/svg","g"),{stroke:l(o.color||"#f00"),strokeWidth:1}),o.rectangles.forEach((function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","line");c(e,{x1:t.x,y1:t.y,x2:t.x+t.width,y2:t.y}),i.appendChild(e)})),r=i;break;case"point":r=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","rect"),o=document.createElementNS("http://www.w3.org/2000/svg","path");return c(e,{width:s,height:s,x:t.x,y:t.y}),c(n,{width:s,height:s,x:0,y:-1.25,viewBox:"0 0 1000 1000"}),c(r,{width:s,height:s,stroke:"#000",fill:"#ff0"}),c(o,{d:"M499.968 214.336q-113.832 0 -212.877 38.781t-157.356 104.625 -58.311 142.29q0 62.496 39.897 119.133t112.437 97.929l48.546 27.9 -15.066 53.568q-13.392 50.778 -39.06 95.976 84.816 -35.154 153.45 -95.418l23.994 -21.204 31.806 3.348q38.502 4.464 72.54 4.464 113.832 0 212.877 -38.781t157.356 -104.625 58.311 -142.29 -58.311 -142.29 -157.356 -104.625 -212.877 -38.781z",strokeWidth:50,stroke:"#000",fill:"#fff"}),n.appendChild(o),e.appendChild(r),e.appendChild(n),e}(e);break;case"textbox":r=p(e);break;case"drawing":r=function(t){var e=[],n=document.createElementNS("http://www.w3.org/2000/svg","path");if(t.lines.length>0){e.push("M".concat(t.lines[0][0]," ").concat(t.lines[0][1]));for(var r=1,o=t.lines.length;r<o;r++){var i=t.lines[r];t.lines[r+1]&&e.push("L".concat(i[0]," ").concat(i[1]))}}return c(n,{d:"".concat(e.join(" ")),stroke:l(t.color||"#000"),strokeWidth:t.width||1,fill:"none"}),n}(e);break;case"arrow":r=function(t){var e,n,r=document.createElementNS("http://www.w3.org/2000/svg","polygon");if(2===t.lines.length){var o=t.lines[0],i=t.lines[t.lines.length-1],a=v(o[0],o[1],0),u=v(i[0],i[1],0),s=b(a,u),d=E(s);s=b(a,u=w(a,x(d,40)));var f=E((n=g(0,0,1),g((e=d).ycoord*n.zcoord-e.zcoord*n.ycoord,e.zcoord*n.xcoord-e.xcoord*n.zcoord,e.xcoord*n.ycoord-e.ycoord*n.xcoord))),p=t.width||10,y=w(a,x(f,.5*p)),m=w(y,x(d,A(s)-2*p)),h=w(m,x(f,p)),I=u,C=w(a,x(S(f),.5*p)),L=w(C,x(d,A(s)-2*p)),k=w(L,x(S(f),p));c(r,{points:y.x+","+y.y+" "+m.x+","+m.y+" "+h.x+","+h.y+" "+I.x+","+I.y+" "+k.x+","+k.y+" "+L.x+","+L.y+" "+C.x+","+C.y,stroke:l(t.color||"#000"),fill:l(t.color||"#000")})}return r}(e)}return r&&(r.setAttribute("data-pdf-annotate-id",e.uuid),r.setAttribute("aria-hidden",!0),Object.keys(e).filter((function(t){return-1===["color","x","y","cx","cy","color","documentId","lines","page","width","class","content","size","rotation","r"].indexOf(t)})).forEach((function(t){r.setAttribute("data-pdf-annotate-".concat(t),e[t])})),t.appendChild(L(r,n))),r}var _="#00BFFF",O=document.createElement("style");function N(t){for(var e=t;(e=e.parentNode)&&e!==document;)if("SVG"===e.nodeName.toUpperCase()&&"true"===e.getAttribute("data-pdf-annotate-container"))return e;return null}function P(t,e){for(var n=document.elementsFromPoint(t,e),r=0,o=n.length;r<o;r++)if(n[r].classList.contains("no-annotation"))return!0;return!1}function j(t,e){var n=document.querySelectorAll('svg[data-pdf-annotate-container="true"]');if(!P(t,e)){for(var r=0,o=n.length;r<o;r++){var i=n[r];if(M(t,e,i.getBoundingClientRect()))return i}return null}}function T(t,e){var n=j(t,e);if(n){for(var r=n.querySelectorAll("[data-pdf-annotate-type]"),o=0,i=r.length;o<i;o++){var a=r[o];if(M(t,e,q(a)))return a}return null}}function M(t,e,n){return e>=n.top&&e<=n.bottom&&t>=n.left&&t<=n.right}function q(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.getBoundingClientRect(),r=n.width,o=n.height,i=0,a=0;if(["line"].indexOf(t.tagName.toLowerCase())>-1&&t.getBBox){var c=t.getBBox();i=(n.width-c.width)/2,a=(n.height-c.height)/2,r=c.width,o=c.height}var u=Y(t),l=u.offsetLeft,s=u.offsetTop;return e||(l=0,s=0),{top:n.top-s+a,left:n.left-l+i,bottom:n.bottom-s-a,right:n.right-l-i,width:r,height:o}}function R(t,e){var n={},r=U(t).viewport;return Object.keys(e).forEach((function(t){n[t]=e[t]*r.scale})),n}function B(t,e,n){var r=[1,0,0,1,0,0];r=m(r=h(r,(n=n||U(e).viewport).scale,n.scale),n.rotation);var o,i,a,c=C(n);return o=t,a=(i=r=y(r,c.x,c.y))[0]*i[3]-i[1]*i[2],[(o[0]*i[3]-o[1]*i[2]+i[2]*i[5]-i[4]*i[3])/a,(-o[0]*i[1]+o[1]*i[0]+i[4]*i[1]-i[5]*i[0])/a]}function F(t,e,n){var r=[1,0,0,1,0,0];r=m(r=h(r,(n=n||U(e).viewport).scale,n.scale),n.rotation);var o,i,a=C(n);return i=r=y(r,a.x,a.y),[(o=t)[0]*i[0]+o[1]*i[2]+i[4],o[0]*i[1]+o[1]*i[3]+i[5]]}function z(t,e){var n={},r=U(t).viewport;return Object.keys(e).forEach((function(t){n[t]=e[t]/r.scale})),n}function Y(t){for(var e=t;(e=e.parentNode)&&e!==document&&"SVG"!==e.nodeName.toUpperCase(););var n=e.getBoundingClientRect();return{offsetLeft:n.left,offsetTop:n.top}}function H(){O.parentNode||document.head.appendChild(O)}function X(){O.parentNode&&O.parentNode.removeChild(O)}function U(t){return{documentId:t.getAttribute("data-pdf-annotate-document"),pageNumber:parseInt(t.getAttribute("data-pdf-annotate-page"),10),viewport:JSON.parse(t.getAttribute("data-pdf-annotate-viewport"))}}O.innerHTML="\nbody {\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n",O.setAttribute("data-pdf-annotate-user-select","true");var D,Q=new(o()),$=!0;function W(){Q.emit.apply(Q,arguments)}function J(){Q.on.apply(Q,arguments)}function V(){Q.removeListener.apply(Q,arguments)}function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function K(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}document.addEventListener("click",(function(t){if($&&j(t.clientX,t.clientY)){var e=T(t.clientX,t.clientY);D&&D!==e&&Q.emit("annotation:blur",D),e&&Q.emit("annotation:click",e),D=e}}));var Z=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};G(this,e),Object.keys(n).forEach((function(e){"function"==typeof n[e]&&"function"==typeof t[e]&&(t[e]=n[e])})),this.history={}}var n,r;return n=e,r=[{key:"__getAllAnnotations",value:function(e){t("getAllAnnotations")}},{key:"getAllAnnotations",get:function(){return this.__getAllAnnotations},set:function(t){this.__getAllAnnotations=function(e){return t.apply(void 0,arguments).then((function(t){return t.annotations&&t.annotations.forEach((function(t){t.documentId=e})),t}))}}},{key:"__getAnnotations",value:function(e,n){t("getAnnotations")}},{key:"getAnnotations",get:function(){return this.__getAnnotations},set:function(t){this.__getAnnotations=function(e,n){return t.apply(void 0,arguments).then((function(t){return t.annotations&&t.annotations.forEach((function(t){t.documentId=e})),t}))}}},{key:"getAnnotation",value:function(e,n){t("getAnnotation")}},{key:"__addAnnotation",value:function(e,n,r){t("addAnnotation")}},{key:"addAnnotation",get:function(){return this.__addAnnotation},set:function(t){this.__addAnnotation=function(e,n,r){return t.apply(void 0,arguments).then((function(t){return W("annotation:add",e,n,t),t}))}}},{key:"__editAnnotation",value:function(e,n,r){t("editAnnotation")}},{key:"editAnnotation",get:function(){return this.__editAnnotation},set:function(t){this.__editAnnotation=function(e,n,r){return t.apply(void 0,arguments).then((function(t){return W("annotation:edit",e,n,t),t}))}}},{key:"__deleteAnnotation",value:function(e,n){t("deleteAnnotation")}},{key:"deleteAnnotation",get:function(){return this.__deleteAnnotation},set:function(t){this.__deleteAnnotation=function(e,n){return t.apply(void 0,arguments).then((function(t){return t&&W("annotation:delete",e,n),t}))}}},{key:"getComments",value:function(e,n){t("getComments")}},{key:"__addComment",value:function(e,n,r){t("addComment")}},{key:"addComment",get:function(){return this.__addComment},set:function(t){this.__addComment=function(e,n,r){return t.apply(void 0,arguments).then((function(t){return W("comment:add",e,n,t),t}))}}},{key:"__deleteComment",value:function(e,n){t("deleteComment")}},{key:"deleteComment",get:function(){return this.__deleteComment},set:function(t){this.__deleteComment=function(e,n){return t.apply(void 0,arguments).then((function(t){return t&&W("comment:delete",e,n),t}))}}},{key:"__undo",value:function(e){t("undo")}},{key:"undo",get:function(){return this.__undo},set:function(t){this.__undo=function(e){return t.apply(void 0,arguments).then((function(t){return t}))}}},{key:"__redo",value:function(e){t("redo")}},{key:"redo",get:function(){return this.__redo},set:function(t){this.__redo=function(e){return t.apply(void 0,arguments).then((function(t){return t}))}}},{key:"__clearHistory",value:function(e){t("clearHistory")}},{key:"clearHistory",get:function(){return this.__clearHistory},set:function(t){this.__clearHistory=function(e){return t.apply(void 0,arguments).then((function(t){return t}))}}},{key:"historyStatus",value:function(e){t("historyStatus")}}],r&&K(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),e}(),tt=/[xy]/g;function et(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}function nt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(tt,et)}function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function ot(t,e){return ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ot(t,e)}function it(t,e){if(e&&("object"===rt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function at(t){return at=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},at(t)}var ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ot(t,e)}(i,t);var e,n,r,o=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=at(n);if(r){var o=at(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return it(this,t)});function i(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),t=o.call(this,{getAnnotations:function(t,e){return new Promise((function(n,r){var o=ut(t).filter((function(t){return t.page===e&&"Annotation"===t.class}));n({documentId:t,pageNumber:e,annotations:o})}))}}),t.getAnnotation=function(t,e){return Promise.resolve(ut(t)[st(t,e)])},t.addAnnotation=function(e,n,r){return new Promise((function(o,i){r.class="Annotation",r.uuid=nt(),r.page=n;var a=ut(e);a.push(r),lt(e,a,t.history),o(r)}))},t.editAnnotation=function(e,n,r){return new Promise((function(o,i){var a=ut(e);a[st(e,n)]=r,lt(e,a,t.history),o(r)}))},t.deleteAnnotation=function(e,n){return new Promise((function(r,o){ut(e).filter((function(t){return t.uuid===n}))[0];var i=st(e,n);if(i>-1){var a=ut(e);a.splice(i,1),lt(e,a,t.history)}r(!0)}))},t.getComments=function(t,e){return new Promise((function(n,r){n(ut(t).filter((function(t){return"Comment"===t.class&&t.annotation===e})))}))},t.addComment=function(e,n,r){return new Promise((function(o,i){var a={class:"Comment",uuid:nt(),annotation:n,content:r},c=ut(e);c.push(a),lt(e,c,t.history),o(a)}))},t.deleteComment=function(e,n){return new Promise((function(r,o){var i=ut(e).filter((function(t){return t.uuid===n}))[0]||{};if(!i)return o("Could not find annotation");for(var a=-1,c=ut(e),u=0,l=c.length;u<l;u++)if(c[u].uuid===n){a=u;break}a>-1&&(c.splice(a,1),lt(e,c,t.history)),r(!0)}))},t.getAllAnnotations=function(t){return new Promise((function(e,n){e(ut(t))}))},t.undo=function(e){return new Promise((function(n,r){if(!t.history[e]||0===t.history[e].idx)return r("No history now.");var o=t.history[e].idx;if(console.log(o),!t.history[e].record[o-1])return r("invalid idx.");var i=t.history[e].record[o-1];t.history[e].idx=o-1,lt(e,i),n(!0)}))},t.redo=function(e){return new Promise((function(n,r){if(!t.history[e])return r("No history now.");var o=t.history[e].idx;if(console.log(o),!t.history[e].record[o+1])return r("invalid idx.");var i=t.history[e].record[o+1];t.history[e].idx=o+1,lt(e,i),n(!0)}))},t.clearHistory=function(e){return new Promise((function(n,r){delete t.history[e],n(!0)}))},t.historyStatus=function(e){return new Promise((function(n,r){var o=!1,i=!1,a=!1,c=null;t.history[e]&&(c=t.history[e].idx),t.history[e]&&(a=!0,0!==t.history[e].idx&&(o=!0),t.history[e].record.length>c&&(i=!0)),n([o,i,a])}))},t}return e=i,Object.defineProperty(e,"prototype",{writable:!1}),e}(Z);function ut(t){var e=localStorage.getItem("".concat(t,"/annotations"));return"undefined"===e&&(e="[]"),JSON.parse(e)||[]}function lt(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n){n[t]||(n[t]={record:[ut(t)],idx:0});var r=n[t].idx;n[t].record[r+1]=e,n[t].idx=r+1,n[t].record.length=r+2}localStorage.setItem("".concat(t,"/annotations"),JSON.stringify(e))}function st(t,e){for(var n=-1,r=ut(t),o=0,i=r.length;o<i;o++)if(r[o].uuid===e){n=o;break}return n}function dt(t){return dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dt(t)}function ft(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function mt(t,e){return mt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},mt(t,e)}function ht(t,e){if(e&&("object"===dt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function vt(t){return vt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},vt(t)}var gt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&mt(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=vt(r);if(o){var n=vt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return ht(this,t)});function a(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user",n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return pt(this,a),t=i.call(this,{getAnnotations:function(t,e){return new Promise((function(n,r){var o=bt(t).filter((function(t){return t.page===e&&"Annotation"===t.class}));n({documentId:t,pageNumber:e,annotations:o})}))}}),t._userId=e,t._globalEdit=n,t.getAnnotation=function(e,n){return Promise.resolve(wt(e,t._userId)[At(e,t._userId,n)])},t.addAnnotation=function(e,n,r){return new Promise((function(o,i){r.class="Annotation",r.uuid=nt(),r.page=n,r.userId=t._userId;var a=wt(e,t._userId);a.push(r),xt(e,t._userId,a,t.history),o(r)}))},t.editAnnotation=function(e,n,r){return new Promise((function(o,i){!t._globalEdit&&r.userId&&r.userId!==t._userId&&i("Non-matching userId");var a=wt(e,r.userId);a[At(e,r.userId,n)]=r,xt(e,r.userId,a,t.history),o(r)}))},t.deleteAnnotation=function(e,n){return new Promise((function(r,o){var i=bt(e).filter((function(t){return t.uuid===n}))[0]||{};if(!i)return o("Could not find annotation");if(!t._globalEdit&&i.userId&&i.userId!==t._userId)return o("Non-matching userId");var a=At(e,i.userId,n);if(a>-1){var c=wt(e,i.userId);c.splice(a,1),xt(e,i.userId,c,t.history)}r(!0)}))},t.getComments=function(e,n){return new Promise((function(r,o){r(wt(e,t._userId).filter((function(t){return"Comment"===t.class&&t.annotation===n})))}))},t.addComment=function(e,n,r){return new Promise((function(o,i){var a={class:"Comment",uuid:nt(),annotation:n,content:r,userId:t._userId},c=wt(e,t._userId);c.push(a),xt(e,t._userId,c,t.history),o(a)}))},t.deleteComment=function(e,n){return new Promise((function(r,o){var i=bt(e).filter((function(t){return t.uuid===n}))[0]||{};if(!i)return o("Could not find annotation");if(!t._globalEdit&&i.userId&&i.userId!==t._userId)return o("Non-matching userId");for(var a=-1,c=wt(e,i.userId),u=0,l=c.length;u<l;u++)if(c[u].uuid===n){a=u;break}a>-1&&(c.splice(a,1),xt(e,i.userId,c,t.history)),r(!0)}))},t.undo=function(e){return new Promise((function(n,r){if(!t.history[e][t._userId]||0===t.history[e][t._userId].idx)return r("No history now.");var o=t.history[e][t._userId].idx;if(console.log(o),!t.history[e][t._userId].record[o-1])return r("invalid idx.");var i=t.history[e][t._userId].record[o-1];t.history[e][t._userId].idx=o-1,xt(e,i),n(!0)}))},t.redo=function(e){return new Promise((function(n,r){if(!t.history[e][t._userId])return r("No history now.");var o=t.history[e][t._userId].idx;if(console.log(o),!t.history[e][t._userId].record[o+1])return r("invalid idx.");var i=t.history[e][t._userId].record[o+1];t.history[e][t._userId].idx=o+1,xt(e,i),n(!0)}))},t.clearHistory=function(e){return new Promise((function(n,r){delete t.history[e][t._userId],n(!0)}))},t.historyStatus=function(e){return new Promise((function(n,r){var o=!1,i=!1,a=!1,c=null;t.history[e][t._userId]&&(c=t.history[e][t._userId].idx),t.history[e][t._userId]&&(a=!0,0!==t.history[e][t._userId].idx&&(o=!0),t.history[e][t._userId].record.length>c&&(i=!0)),n([o,i,a])}))},t}return e=a,(n=[{key:"userId",get:function(){return this._userId}}])&&yt(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Z);function bt(t){for(var e=[],n=new RegExp("".concat(t,"/(.*)/annotations")),r=0;r<localStorage.length;r++)localStorage.key(r).search(n)>-1&&e.push.apply(e,function(t){if(Array.isArray(t))return ft(t)}(o=JSON.parse(localStorage.getItem(localStorage.key(r))))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(o)||function(t,e){if(t){if("string"==typeof t)return ft(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ft(t,e):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var o;return e}function wt(t,e){return JSON.parse(localStorage.getItem("".concat(t,"/").concat(e,"/annotations")))||[]}function xt(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(r){var o;if(null==r||null===(o=r[t])||void 0===o||!o[e]){var i={record:[wt(t)],idx:0};r[t]||(r[t]={}),r[t][e]=i}var a=r[t][e].idx;r[t][e].record[a+1]=n,r[t][e].idx=a+1,r[t][e].record.length=a+2}localStorage.setItem("".concat(t,"/").concat(e,"/annotations"),JSON.stringify(n))}function At(t,e,n){for(var r=-1,o=wt(t,e),i=0,a=o.length;i<a;i++)if(o[i].uuid===n){r=i;break}return r}const St={annotationLayerName:"annotationLayer",textLayerName:"textLayer",annotationSvgQuery:function(){return"svg."+this.annotationLayerName},annotationClassQuery:function(){return"."+this.annotationLayerName},textClassQuery:function(){return"."+this.textLayerName}};function Et(t){return function(t){if(Array.isArray(t))return Ct(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||It(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function It(t,e){if(t){if("string"==typeof t)return Ct(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ct(t,e):void 0}}function Ct(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Lt,kt,_t,Ot,Nt,Pt=!1,jt=!1;function Tt(t){Mt(),Lt=document.createElement("div");var e=document.createElement("a"),n=N(t).parentNode,r=t.getAttribute("data-pdf-annotate-id"),o=q(t,!0),i=o.left-3,a=o.top-3;Lt.setAttribute("id","pdf-annotate-edit-overlay"),Lt.setAttribute("data-target-id",r),Lt.style.boxSizing="content-box",Lt.style.position="absolute",Lt.style.top="".concat(a,"px"),Lt.style.left="".concat(i,"px"),Lt.style.width="".concat(o.width,"px"),Lt.style.height="".concat(o.height,"px"),Lt.style.border="".concat(3,"px solid ").concat(_),Lt.style.borderRadius="".concat(3,"px"),Lt.style.zIndex=20100,e.innerHTML="Ã—",e.setAttribute("href","javascript://"),e.style.background="#fff",e.style.borderRadius="20px",e.style.border="1px solid #bbb",e.style.color="#bbb",e.style.fontSize="16px",e.style.padding="2px",e.style.textAlign="center",e.style.textDecoration="none",e.style.position="absolute",e.style.top="-13px",e.style.right="-13px",e.style.width="25px",e.style.height="25px",Lt.appendChild(e),n.appendChild(Lt),document.addEventListener("click",Rt),document.addEventListener("keyup",Bt),document.addEventListener("mousedown",Ft),e.addEventListener("click",qt),e.addEventListener("mouseover",(function(){e.style.color="#35A4DC",e.style.borderColor="#999",e.style.boxShadow="0 1px 1px #ccc"})),e.addEventListener("mouseout",(function(){e.style.color="#bbb",e.style.borderColor="#bbb",e.style.boxShadow=""})),Lt.addEventListener("mouseover",(function(){jt||(e.style.display="")})),Lt.addEventListener("mouseout",(function(){e.style.display="none"}))}function Mt(){Lt&&(Lt.parentNode.removeChild(Lt),Lt=null),document.removeEventListener("click",Rt),document.removeEventListener("keyup",Bt),document.removeEventListener("mousedown",Ft),document.removeEventListener("mousemove",zt),document.removeEventListener("mouseup",Yt),X()}function qt(){if(Lt){var t=Lt.getAttribute("data-target-id"),e=U(Lt.parentNode.querySelector(St.annotationSvgQuery())).documentId;wn.getStoreAdapter().deleteAnnotation(e,t).then((function(){Et(document.querySelectorAll('[data-pdf-annotate-id="'.concat(t,'"]'))).forEach((function(t){t.parentNode.removeChild(t)}))})),Mt()}}function Rt(t){if(j(t.clientX,t.clientY)){var e=document.getElementById("pdf-annotate-edit-overlay");if(e){if(jt||t.target===e)return;Mt()}}}function Bt(t){var e;e=t.key?"delete"===t.key.toLowerCase()||"backspace"===t.key.toLowerCase():8===t.keyCode||46===t.keyCode,Lt&&e&&"textarea"!==t.target.nodeName.toLowerCase()&&"input"!==t.target.nodeName.toLowerCase()&&(t.preventDefault(),qt())}function Ft(t){if(t.target===Lt){var e=Lt.getAttribute("data-target-id"),n=document.querySelector('[data-pdf-annotate-id="'.concat(e,'"]')).getAttribute("data-pdf-annotate-type");"highlight"!==n&&"strikeout"!==n&&(jt=!0,kt=t.clientX,_t=t.clientY,Ot=Lt.offsetLeft,Nt=Lt.offsetTop,Lt.style.background="rgba(255, 255, 255, 0.7)",Lt.style.cursor="move",Lt.querySelector("a").style.display="none",document.addEventListener("mousemove",zt),document.addEventListener("mouseup",Yt),H())}}function zt(t){var e=Lt.parentNode.getBoundingClientRect(),n=Nt+(t.clientY-_t),r=Ot+(t.clientX-kt),o=e.height,i=e.width;n>0&&n+Lt.offsetHeight<o&&(Lt.style.top="".concat(n,"px")),r>0&&r+Lt.offsetWidth<i&&(Lt.style.left="".concat(r,"px"))}function Yt(t){var e=Lt.getAttribute("data-target-id"),n=document.querySelectorAll('[data-pdf-annotate-id="'.concat(e,'"]')),r=n[0].getAttribute("data-pdf-annotate-type"),o=Lt.parentNode.querySelector(St.annotationSvgQuery()),i=U(o).documentId;Lt.querySelector("a").style.display="",wn.getStoreAdapter().getAnnotation(i,e).then((function(t){var a="x",c="y";if(["circle","fillcircle","emptycircle"].indexOf(r)>-1&&(a="cx",c="cy"),"point"===r)Et(n).forEach((function(e,n){var r={x:Lt.offsetLeft,y:Lt.offsetTop},i=z(o,r);e.setAttribute(a,i.x),e.setAttribute(c,i.y),t[a]=i.x,t[c]=i.y}));else if(["area","highlight","textbox","circle","fillcircle","emptycircle"].indexOf(r)>-1){var u=B([Ot,Nt],o),l=B([Lt.offsetLeft,Lt.offsetTop],o),s={x:l[0]-u[0],y:l[1]-u[1]};"textbox"===r&&(n=[n[0].firstChild,n[0].firstChild.firstChild]),Et(n).forEach((function(e,n){var r=parseInt(e.getAttribute(a),10),o=parseInt(e.getAttribute(c),10);0!==s.y&&(o+=s.y,e.setAttribute(c,o),t.rectangles&&n<t.rectangles.length?t.rectangles[n].y=o:t[c]&&(t[c]=o)),0!==s.x&&(r+=s.x,e.setAttribute(a,r),t.rectangles&&n<t.rectangles.length?t.rectangles[n].x=r:t[a]&&(t[a]=r))}))}else{if("strikeout"===r)return;if("drawing"===r||"arrow"===r){var d=B([Ot,Nt],o),f=B([Lt.offsetLeft,Lt.offsetTop],o),p={x:f[0]-d[0],y:f[1]-d[1]};t.lines.forEach((function(e,n){var r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||It(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.lines[n],2),o=r[0],i=r[1];t.lines[n][0]=parseFloat(o)+p.x,t.lines[n][1]=parseFloat(i)+p.y})),n[0].parentNode.removeChild(n[0]),k(o,t)}}wn.getStoreAdapter().editAnnotation(i,e,t)})),setTimeout((function(){jt=!1}),0),Lt.style.background="",Lt.style.cursor="",document.removeEventListener("mousemove",zt),document.removeEventListener("mouseup",Yt),X()}function Ht(t){Tt(t)}var Xt,Ut,Dt,Qt=!1,$t=!1,Wt=[];function Jt(t){Dt=null,Wt=[],$t=!0,P(t.x,t.y)||t.preventDefault()}function Vt(t){!function(t,e){var n;if($t=!1,Wt.length>1&&(n=j(t,e))){var r=U(n),o=r.documentId,i=r.pageNumber;wn.getStoreAdapter().addAnnotation(o,i,{type:"drawing",width:Xt,color:Ut,lines:Wt}).then((function(t){Dt&&n.removeChild(Dt),k(n,t)}))}}(t.clientX,t.clientY)}function Gt(t){$t&&function(t,e){var n=j(t,e);if(n){var r=n.getBoundingClientRect(),o=B([t-r.left,e-r.top],n);o[0]=o[0].toFixed(2),o[1]=o[1].toFixed(2),Wt.push(o),Wt.length<=1||(Dt&&n.removeChild(Dt),Dt=k(n,{type:"drawing",color:Ut,width:Xt,lines:Wt}))}}(t.clientX,t.clientY)}function Kt(t){27===t.keyCode&&(Wt=null,Dt.parentNode.removeChild(Dt),document.removeEventListener("pointermove",Gt),document.removeEventListener("pointerup",Vt))}var Zt,te,ee,ne,re,oe,ie=!1;function ae(t){var e=T(t.clientX,t.clientY);if(null!==e){var n=e.getAttribute("data-pdf-annotate-type");if("circle"===n||"fillcircle"===n||"emptycircle"===n){var r=N(e),o=U(r).documentId,i=e.getAttribute("data-pdf-annotate-id");wn.getStoreAdapter().getAnnotation(o,i).then((function(t){if(t){ee=null,ne=[];var e=F([t.cx,t.cy],r),n=r.getBoundingClientRect();oe=e[0]+n.left,re=e[1]+n.top,document.addEventListener("mousemove",ue),document.addEventListener("mouseup",ce)}}))}}}function ce(t){var e;if(ne.length>1&&(e=j(t.clientX,t.clientY))){var n=U(e),r=n.documentId,o=n.pageNumber;wn.getStoreAdapter().addAnnotation(r,o,{type:"arrow",width:Zt,color:te,lines:ne}).then((function(t){ee&&e.removeChild(ee),k(e,t)}))}document.removeEventListener("mousemove",ue),document.removeEventListener("mouseup",ce)}function ue(t){!function(t,e){var n=j(t,e);if(n){var r=n.getBoundingClientRect(),o=B([t-r.left,e-r.top],n);ne.length<2?ne.push(o):(ne[1]=o,ee&&n.removeChild(ee),ee=k(n,{type:"arrow",color:te,width:Zt,lines:ne}))}}(0===ne.length?oe:t.clientX,0===ne.length?re:t.clientY)}function le(t){27===t.keyCode&&(ne=null,ee.parentNode.removeChild(ee),document.removeEventListener("mousemove",ue),document.removeEventListener("mouseup",ce))}function se(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var de=!1,fe=null;function pe(t){de=!0,fe=[t.clientX,t.clientY]}function ye(t){de=!1,he(T(t.clientX,t.clientY))}function me(t){if(de){var e=[],n=Math.abs(fe[0]-t.clientX),r=Math.abs(fe[1]-t.clientY);if(n>=1||r>=1)for(var o=Math.round(Math.max(n,r)),i=Math.min(n,r)/o,a=n<r,c=[Math.min(fe[0],t.clientX),Math.min(fe[1],t.clientY)],u=0;u<o;u++)a?e.push([Math.round(c[0]+i*u),Math.round(c[1]+u)]):e.push([Math.round(c[0]+u),Math.round(c[1]+i*u)]);for(var l=0,s=e;l<s.length;l++){var d=s[l];he(T(d[0],d[1]))}fe=[t.clientX,t.clientY]}}function he(t){if(de&&t){var e=U(t.parentElement).documentId,n=t.getAttribute("data-pdf-annotate-id");wn.getStoreAdapter().deleteAnnotation(e,n).then((function(){var t;(t=document.querySelectorAll('[data-pdf-annotate-id="'.concat(n,'"]')),function(t){if(Array.isArray(t))return se(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return se(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?se(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).forEach((function(t){t.parentNode.removeChild(t)}))}))}}var ve,ge=!1;function be(t){!ve&&j(t.clientX,t.clientY)&&((ve=document.createElement("input")).setAttribute("id","pdf-annotate-point-input"),ve.setAttribute("placeholder","Enter comment"),ve.style.border="3px solid ".concat(_),ve.style.borderRadius="3px",ve.style.position="absolute",ve.style.top="".concat(t.clientY,"px"),ve.style.left="".concat(t.clientX,"px"),ve.addEventListener("blur",we),ve.addEventListener("keyup",xe),document.body.appendChild(ve),ve.focus())}function we(){Ae()}function xe(t){27===t.keyCode?Se():13===t.keyCode&&Ae()}function Ae(){if(ve.value.trim().length>0){var t=parseInt(ve.style.left,10),e=parseInt(ve.style.top,10),n=ve.value.trim(),r=j(t,e);if(!r)return;var o=r.getBoundingClientRect(),i=U(r),a=i.documentId,c=i.pageNumber,u=Object.assign({type:"point"},z(r,{x:t-o.left,y:e-o.top}));wn.getStoreAdapter().addAnnotation(a,c,u).then((function(t){wn.getStoreAdapter().addComment(a,t.uuid,n),k(r,t)}))}Se()}function Se(){ve.removeEventListener("blur",we),ve.removeEventListener("keyup",xe),document.body.removeChild(ve),ve=null}function Ee(t){return function(t){if(Array.isArray(t))return Ie(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Ie(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ie(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ie(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Ce,Le,ke,_e,Oe=!1;function Ne(t){var e;if("area"===Ce&&(e=j(t.clientX,t.clientY))){var n=e.getBoundingClientRect();ke=t.clientY,_e=t.clientX,(Le=document.createElement("div")).style.position="absolute",Le.style.top="".concat(ke-n.top,"px"),Le.style.left="".concat(_e-n.left,"px"),Le.style.border="3px solid ".concat(_),Le.style.borderRadius="3px",e.parentNode.appendChild(Le),document.addEventListener("mousemove",Pe),H()}}function Pe(t){var e=Le.parentNode.querySelector(St.annotationSvgQuery()).getBoundingClientRect();_e+(t.clientX-_e)<e.right&&(Le.style.width="".concat(t.clientX-_e,"px")),ke+(t.clientY-ke)<e.bottom&&(Le.style.height="".concat(t.clientY-ke,"px"))}function je(t){var e;if(!P(t.clientX,t.clientY))if("area"!==Ce&&(e=function(){try{var t=window.getSelection().getRangeAt(0).getClientRects();if(t.length>0&&t[0].width>0&&t[0].height>0)return t}catch(t){}return null}()))Me(Ce,Ee(e).map((function(t){return{top:t.top,left:t.left,width:t.width,height:t.height}})));else if("area"===Ce&&Le){var n=Le.parentNode.querySelector(St.annotationSvgQuery()).getBoundingClientRect();Me(Ce,[{top:parseInt(Le.style.top,10)+n.top,left:parseInt(Le.style.left,10)+n.left,width:parseInt(Le.style.width,10),height:parseInt(Le.style.height,10)}]),Le.parentNode.removeChild(Le),Le=null,document.removeEventListener("mousemove",Pe),X()}}function Te(t){27===t.keyCode&&(window.getSelection().removeAllRanges(),Le&&Le.parentNode&&(Le.parentNode.removeChild(Le),Le=null,document.removeEventListener("mousemove",Pe)))}function Me(t,e,n){var r,o=j(e[0].left,e[0].top);if(o){var i=o.getBoundingClientRect();if(n||("highlight"===t?n="FFFF00":"strikeout"===t&&(n="FF0000")),r={type:t,color:n,rectangles:Ee(e).map((function(e){var n=0;return"strikeout"===t&&(n=e.height/2),function(t,e,n){var r=[t.x,t.y],o=[t.x+t.width,t.y+t.height];return r=B(r,e,n),o=B(o,e,n),{x:Math.min(r[0],o[0]),y:Math.min(r[1],o[1]),width:Math.abs(o[0]-r[0]),height:Math.abs(o[1]-r[1])}}({y:e.top+n-i.top,x:e.left-i.left,width:e.width,height:e.height},o)})).filter((function(t){return t.width>0&&t.height>0&&t.x>-1&&t.y>-1}))},0!==r.rectangles.length){if("area"===t){var a=r.rectangles[0];delete r.rectangles,r.x=a.x,r.y=a.y,r.width=a.width,r.height=a.height}var c=U(o),u=c.documentId,l=c.pageNumber;wn.getStoreAdapter().addAnnotation(u,l,r).then((function(t){k(o,t)}))}}}var qe,Re=!1,Be=10,Fe="0000FF";function ze(t){var e=j(t.clientX,t.clientY);if(e){var n=e.getBoundingClientRect();!function(t,e,n,r,o){var i=B([n.x,n.y],t),a={type:e,color:o,cx:i[0],cy:i[1],r},c=U(t),u=c.documentId,l=c.pageNumber;wn.getStoreAdapter().addAnnotation(u,l,a).then((function(e){k(t,e)}))}(e,qe,{x:t.clientX-n.left,y:t.clientY-n.top},Be,Fe)}}var Ye,He,Xe,Ue=!1;function De(t){!Ye&&j(t.clientX,t.clientY)&&((Ye=document.createElement("textarea")).setAttribute("id","pdf-annotate-text-input"),Ye.setAttribute("placeholder","Enter text... SHIFT + ENTER for new line"),Ye.style.border="3px solid ".concat(_),Ye.style.borderRadius="3px",Ye.style.position="absolute",Ye.style.top="".concat(t.clientY,"px"),Ye.style.left="".concat(t.clientX,"px"),Ye.style.fontSize="".concat(He,"px"),Ye.style.zIndex="41",Ye.addEventListener("blur",Qe),Ye.addEventListener("keyup",$e),document.body.appendChild(Ye),Ye.focus())}function Qe(){We()}function $e(t){27===t.keyCode?Je():13!==t.keyCode||t.shiftKey||We()}function We(){var t=Ye.value?Ye.value.replace(/ +$/,""):"";if(t.length>0){var e=parseInt(Ye.style.left,10),n=parseInt(Ye.style.top,10),r=j(e,n);if(!r)return;var o=He,i=U(r),a=i.documentId,c=i.pageNumber,u=i.viewport,l=1/u.scale,s=r.getBoundingClientRect(),d=B([e-s.left,n-s.top+o],r,u),f={type:"textbox",size:He*l,color:Xe,content:t,x:d[0],y:d[1],rotation:-u.rotation};wn.getStoreAdapter().addAnnotation(a,c,f).then((function(t){k(r,t)}))}Je()}function Je(){Ye&&(Ye.removeEventListener("blur",Qe),Ye.removeEventListener("keyup",$e),document.body.removeChild(Ye),Ye=null)}function Ve(t,e){var n=document.createElement("div"),r=document.createTextNode(t);return n.appendChild(r),n.setAttribute("id","pdf-annotate-screenreader-".concat(e)),n.style.position="absolute",n.style.left="-10000px",n.style.top="auto",n.style.width="1px",n.style.height="1px",n.style.overflow="hidden",n}function Ge(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ke(t,e,n,r,o){var i=function(t,e,n){var r,o=document.querySelector('svg[data-pdf-annotate-page="'.concat(n,'"]')),i=o.getBoundingClientRect();return e=R(o,{y:e}).y+i.top,t=R(o,{x:t}).x+i.left,(r=o.parentNode.querySelectorAll(St.textClassQuery()+" [data-canvas-width]"),function(t){if(Array.isArray(t))return Ge(t)}(r)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||function(t,e){if(t){if("string"==typeof t)return Ge(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ge(t,e):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).filter((function(n){return M(t,e,n.getBoundingClientRect())}))[0]}(e=Math.max(e+2*(o?1:-1),0),n+2,r);if(!i)return!1;e+=2*(o?-1:1);var a=document.querySelector('svg[data-pdf-annotate-page="'.concat(r,'"]')),c=z(a,{left:i.getBoundingClientRect().left}).left-a.getBoundingClientRect().left,u=i.cloneNode(!0),l=u.innerHTML.split(""),s=[];for(u.style.position="absolute",u.style.top="-10000px",u.style.left="-10000px",document.body.appendChild(u);l.length;){if(">"===l[l.length-1])for(;l.length&&(s.unshift(l.pop()),"<"!==s[0]););if(u.innerHTML=l.join(""),c+z(a,{width:u.getBoundingClientRect().width}).width<=e)break;s.unshift(l.pop())}return i.innerHTML=l.join("")+t.outerHTML+s.join(""),u.parentNode.removeChild(u),!0}function Ze(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function tn(t,e,n,r){if(Ke(t,e,n,r,!0))return!0;var o,i=document.querySelector('svg[data-pdf-annotate-page="'.concat(r,'"]')),a=i.getBoundingClientRect(),c=function(t){if(Array.isArray(t))return Ze(t)}(o=i.parentNode.querySelectorAll(St.textClassQuery()+" > div"))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(o)||function(t,e){if(t){if("string"==typeof t)return Ze(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ze(t,e):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();n=R(i,{y:n}).y+a.top,e=R(i,{x:e}).x+a.left;for(var u=0,l=c.length;u<l;u++){var s=c[u];if(n<=s.getBoundingClientRect().top)return s.parentNode.insertBefore(t,s),!0}var d=i.parentNode.querySelector(St.textClassQuery());return!(!d||!M(e,n,d.getBoundingClientRect()))&&(d.appendChild(t),!0)}function en(t){if(t){var e=document.querySelector("#pdf-annotate-screenreader-".concat(t.annotation," ol"));if(e){var n=document.createElement("li");n.setAttribute("id","pdf-annotate-screenreader-comment-".concat(t.uuid)),n.appendChild(document.createTextNode("".concat(t.content))),e.appendChild(n)}}}function nn(t,e,n){return(Array.isArray(n)?Promise.resolve(n):wn.getStoreAdapter().getComments(t,e)).then((function(t){var n=document.getElementById("pdf-annotate-screenreader-".concat(e));if(n){var r=document.createElement("ol");r.setAttribute("id","pdf-annotate-screenreader-comment-list-".concat(e)),r.setAttribute("aria-label","Comments"),n.appendChild(r),t.forEach(en)}}))}var rn=["highlight","point","area","circle","emptycircle","fillcircle"];function on(t,e,n){wn.getStoreAdapter().getAnnotations(t,e).then((function(t){return t.annotations.filter((function(t){return t.type===n}))})).then((function(t){return t.forEach((function(t){an(0,t.uuid)})),t})).then(un)}function an(t,e){cn("pdf-annotate-screenreader-".concat(e)),cn("pdf-annotate-screenreader-".concat(e,"-end"))}function cn(t){var e=document.getElementById(t);e&&e.parentNode.removeChild(e)}function un(t){t=Array.isArray(t)?t:[],Object.keys(dn).forEach((function(e){var n=dn[e];t.filter((function(t){return t.type===e})).sort(n).forEach((function(t,e){return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(t.type){case"highlight":case"strikeout":var n=t.rectangles,r=n[0],o=n[n.length-1];Ke(Ve("Begin ".concat(t.type," annotation ").concat(e),t.uuid),r.x,r.y,t.page,!0),Ke(Ve("End ".concat(t.type," annotation ").concat(e),"".concat(t.uuid,"-end")),o.x+o.width,o.y,t.page,!1);break;case"textbox":case"point":var i="textbox"===t.type?" (content: ".concat(t.content,")"):"";tn(Ve("".concat(t.type," annotation ").concat(e).concat(i),t.uuid),t.x,t.y,t.page);break;case"drawing":case"area":var a=void 0!==t.x?t.x:t.lines[0][0],c=void 0!==t.y?t.y:t.lines[0][1];tn(Ve("Unlabeled drawing",t.uuid),a,c,t.page);break;case"circle":case"fillcircle":case"emptycircle":var u=void 0!==t.cx?t.cx:t.lines[0][0],l=void 0!==t.cy?t.cy:t.lines[0][1];tn(Ve("Unlabeled drawing",t.uuid),u,l,t.page)}rn.includes(t.type)&&nn(t.documentId,t.uuid)}(t,e+1)}))}))}function ln(t,e){return t.y<e.y?t.x-e.x:1}function sn(t,e){return ln(t.rectangles[0],e.rectangles[0])}J("annotation:add",(function(t,e,n){on(t,e,n.type)})),J("annotation:edit",(function(t,e,n){on(t,n.page,n.type)})),J("annotation:delete",an),J("comment:add",(function(t,e,n){var r=document.querySelector("pdf-annotate-screenreader-comment-list-".concat(e));(r?Promise.resolve(!0):nn(t,e,[]).then((function(){return r=document.querySelector("pdf-annotate-screenreader-comment-list-".concat(e)),!0}))).then((function(){en(n)}))})),J("comment:delete",(function(t,e){cn("pdf-annotate-screenreader-comment-".concat(e))}));var dn={highlight:sn,strikeout:sn,drawing:function(t,e){var n=t.lines[0],r=e.lines[0];return ln({x:n[0],y:n[1]},{x:r[0],y:r[1]})},textbox:ln,point:ln,area:ln};function fn(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return pn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pn(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var yn='\n  <div style="visibility: hidden;" class="page" data-loaded="false">\n    <div class="canvasWrapper">\n      <canvas></canvas>\n    </div>\n    <svg class="'+St.annotationLayerName+'"></svg>\n    <div class="'+St.textLayerName+'"></div>\n  </div>\n',mn=null;function hn(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return mn||(mn=new pdfjsViewer.EventBus({dispatchToDOM:t})),mn}function vn(t){if(Math.floor(t)===t)return[t,1];var e=1/t;if(e>8)return[1,8];if(Math.floor(e)===e)return[1,e];for(var n=t>1?e:t,r=0,o=1,i=1,a=1;;){var c=r+i,u=o+a;if(u>8)break;n<=c/u?(i=c,a=u):(r=c,o=u)}return n-r/o<i/a-n?n===t?[r,o]:[o,r]:n===t?[i,a]:[a,i]}function gn(t,e){var n=t%e;return 0===n?t:Math.round(t-n+e)}const bn={addEventListener:J,removeEventListener:V,fireEvent:W,removeAllEventListener:function(){Q.removeAllListeners.apply(Q,arguments)},enableUI:function(){$=!0},disableUI:function(){$=!1},disableEdit:function(){Mt(),Pt&&(Pt=!1,V("annotation:click",Ht))},enableEdit:function(){Pt||(Pt=!0,J("annotation:click",Ht))},createEditOverlay:Tt,destroyEditOverlay:Mt,disablePen:function(){Qt&&(Qt=!1,document.removeEventListener("pointerdown",Jt),document.removeEventListener("pointermove",Gt),document.removeEventListener("pointerup",Vt),document.removeEventListener("keyup",Kt),X())},enablePen:function(){Qt||(Qt=!0,document.addEventListener("pointerdown",Jt),document.addEventListener("pointermove",Gt),document.addEventListener("pointerup",Vt),document.addEventListener("keyup",Kt),H())},setPen:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"000000";Xt=Math.round(100*parseFloat(t))/100,Ut=e},disablePoint:function(){ge&&(ge=!1,document.removeEventListener("mouseup",be))},enablePoint:function(){ge||(ge=!0,document.addEventListener("mouseup",be))},disableRect:function(){Oe&&(Oe=!1,document.removeEventListener("mouseup",je),document.removeEventListener("mousedown",Ne),document.removeEventListener("keyup",Te))},enableRect:function(t){Ce=t,Oe||(Oe=!0,document.addEventListener("mouseup",je),document.addEventListener("mousedown",Ne),document.addEventListener("keyup",Te))},disableCircle:function(){Re&&(Re=!1,document.removeEventListener("mouseup",ze))},enableCircle:function(t){qe=t,Re||(Re=!0,document.addEventListener("mouseup",ze))},setCircle:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0000FF";Be=parseInt(t,10),Fe=e},addCircle:function(t,e){var n=qe;qe=t,ze(e),qe=n},disableArrow:function(){ie&&(ie=!1,document.removeEventListener("mousedown",ae),document.removeEventListener("keyup",le),X())},enableArrow:function(){ie||(ie=!0,document.addEventListener("mousedown",ae),document.addEventListener("keyup",le),H())},setArrow:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0000FF";Zt=parseInt(t,10),te=e},disableEraser:function(){document.removeEventListener("pointermove",me),document.removeEventListener("pointerdown",pe),document.removeEventListener("pointerup",ye)},enableEraser:function(){document.addEventListener("pointermove",me),document.addEventListener("pointerdown",pe),document.addEventListener("pointerup",ye)},disableText:function(){Ue&&(Ue=!1,document.removeEventListener("mouseup",De))},enableText:function(){Ue||(Ue=!0,document.addEventListener("mouseup",De))},setText:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"000000";He=parseInt(t,10),Xe=e},createPage:function(t){var e=document.createElement("div");e.innerHTML=yn;var n=e.children[0],r=n.querySelector("canvas");return n.setAttribute("id","pageContainer".concat(t)),n.setAttribute("data-page-number",t),r.mozOpaque=!0,r.setAttribute("id","page".concat(t)),n},renderPage:function(t,e){var n=e.documentId,r=e.pdfDocument,o=e.scale,i=e.rotate;return Promise.all([r.getPage(t),wn.getAnnotations(n,t)]).then((function(e){var n=fn(e,2),r=n[0],a=n[1],c=document.getElementById("pageContainer".concat(t)),u=c.querySelector(St.annotationClassQuery()),l=c.querySelector(".canvasWrapper canvas").getContext("2d",{alpha:!1}),s=(i+r.rotate)%360,d=r.getViewport({scale:o,rotation:s}),f=function(t,e,n){var r,o,i=document.getElementById("pageContainer".concat(t)),a=i.querySelector(".canvasWrapper canvas"),c=i.querySelector(St.annotationClassQuery()),u=i.querySelector(".canvasWrapper"),l=i.querySelector(St.textClassQuery()),s=(r=n,{sx:o=(window.devicePixelRatio||1)/(r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1),sy:o,scaled:1!==o}),d=s.scaled?[s.sx,0,0,s.sy,0,0]:null,f=vn(s.sx),p=vn(s.sy);return i.style.visibility="",a.width=gn(e.width*s.sx,f[0]),a.height=gn(e.height*s.sy,p[0]),a.style.width=gn(e.width,f[1])+"px",a.style.height=gn(e.height,f[1])+"px",c.setAttribute("width",e.width),c.setAttribute("height",e.height),c.style.width="".concat(e.width,"px"),c.style.height="".concat(e.height,"px"),i.style.width="".concat(e.width,"px"),i.style.height="".concat(e.height,"px"),u.style.width="".concat(e.width,"px"),u.style.height="".concat(e.height,"px"),l.style.width="".concat(e.width,"px"),l.style.height="".concat(e.height,"px"),d}(t,d,l);return Promise.all([r.render({canvasContext:l,viewport:d,transform:f}).promise,wn.render(u,d,a)]).then((function(){return r.getTextContent({normalizeWhitespace:!0}).then((function(e){return new Promise((function(n,r){var o=hn(),i=c.querySelector(St.textClassQuery()),u=(new pdfjsViewer.DefaultTextLayerFactory).createTextLayerBuilder(i,t-1,d,!0,o);u.setTextContent(e),u.render(),setTimeout((function(){try{un(a.annotations),n()}catch(t){r(t)}}))}))}))})).then((function(){return c.setAttribute("data-loaded","true"),[r,a]}))}))},rerenderAnnotations:function(t,e){var n=e.documentId,r=e.pdfDocument,o=e.scale,i=e.rotate;return Promise.all([r.getPage(t),wn.getAnnotations(n,t)]).then((function(e){var n=fn(e,2),r=n[0],a=n[1],c=document.getElementById("pageContainer".concat(t)).querySelector(St.annotationClassQuery()),u=(i+r.rotate)%360,l=r.getViewport({scale:o,rotation:u});return Promise.all([wn.render(c,l,a)]).then((function(){})).then((function(){return[r,a]}))}))}},wn={findAnnotationAtPoint:T,findSVGContainer:N,convertToScreenPoint:F,StoreAdapter:Z,LocalStoreAdapter:ct,LocalUserStoreAdapter:gt,__storeAdapter:new Z,getStoreAdapter:function(){return this.__storeAdapter},setStoreAdapter:function(t){this.__storeAdapter=t},UI:bn,render:function(t,e,n){return new Promise((function(r,o){return t.innerHTML="",t.setAttribute("data-pdf-annotate-container",!0),t.setAttribute("data-pdf-annotate-viewport",JSON.stringify(e)),t.removeAttribute("data-pdf-annotate-document"),t.removeAttribute("data-pdf-annotate-page"),n?(t.setAttribute("data-pdf-annotate-document",n.documentId),t.setAttribute("data-pdf-annotate-page",n.pageNumber),Array.isArray(n.annotations)&&0!==n.annotations.length?(n.annotations.forEach((function(n){var r=t.querySelector('[data-pdf-annotate-id="'+n.uuid+'"]');r?function(t,e,n){n||(n=JSON.parse(t.getAttribute("data-pdf-annotate-viewport"))),e&&(e=L(e,n))}(t,r,e):k(t,n,e)})),void r(t)):r(t)):(t.innerHTML="",r(t))}))},getAnnotations:function(t,e){var n;return(n=this.getStoreAdapter()).getAnnotations.apply(n,arguments)},config:St,uuid:nt},xn=wn;function An(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Sn=[{hex:"#000000",name:"Black"},{hex:"#EF4437",name:"Red"},{hex:"#E71F63",name:"Pink"},{hex:"#8F3E97",name:"Purple"},{hex:"#65499D",name:"Deep Purple"},{hex:"#4554A4",name:"Indigo"},{hex:"#2083C5",name:"Blue"},{hex:"#35A4DC",name:"Light Blue"},{hex:"#09BCD3",name:"Cyan"},{hex:"#009688",name:"Teal"},{hex:"#43A047",name:"Green"},{hex:"#8BC34A",name:"Light Green"},{hex:"#FDC010",name:"Yellow"},{hex:"#F8971C",name:"Orange"},{hex:"#F0592B",name:"Deep Orange"},{hex:"#F06291",name:"Light Pink"}];function En(t,e,n){function r(t,e){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];s.setAttribute("data-color",t),s.setAttribute("data-name",e),s.setAttribute("title",e),s.style.background=t,r&&"function"==typeof n&&n(t),o()}function o(){document.removeEventListener("keyup",a),c&&c.parentNode&&c.parentNode.removeChild(c),u=!1,s.focus()}function i(t){var e=document.createElement("a");return e.className="color",e.setAttribute("href","javascript://"),e.setAttribute("title",t.name),e.setAttribute("data-name",t.name),e.setAttribute("data-color",t.hex),e.style.background=t.hex,e}function a(t){27===t.keyCode&&o()}var c,u=!1,l=function(t){var e,n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return An(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?An(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}(Sn);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.hex===t)return r.name}}catch(t){n.e(t)}finally{n.f()}}(e),s=i({hex:e,name:l});s.onclick=function(){u?o():(c||((c=document.createElement("div")).style.background="#fff",c.style.border="1px solid #ccc",c.style.padding="2px",c.style.position="absolute",c.style.width="122px",t.style.position="relative",Sn.map(i).forEach((function(t){t.style.margin="2px",t.onclick=function(){r(t.getAttribute("data-color"),t.getAttribute("data-name"))},c.appendChild(t)}))),document.addEventListener("keyup",a),t.appendChild(c),u=!0)},t.appendChild(s),r(e,l,!1)}function In(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Cn,Ln=xn.UI,kn="example.pdf",_n={documentId:kn,pdfDocument:null,scale:parseFloat(localStorage.getItem("".concat(kn,"/scale")),10)||1.33,rotate:parseInt(localStorage.getItem("".concat(kn,"/rotate")),10)||0};xn.setStoreAdapter(new xn.LocalStoreAdapter),pdfjsLib.workerSrc="./shared/pdf.worker.js";var On=0,Nn=[],Pn=!1;function jn(){pdfjsLib.getDocument({url:_n.documentId,cMapUrl:"shared/cmaps/",cMapPacked:!0}).promise.then((function(t){_n.pdfDocument=t;var e=document.getElementById("viewer");e.innerHTML="",On=t.numPages;for(var n=0;n<On;n++){var r=Ln.createPage(n+1);e.appendChild(r)}Ln.renderPage(1,_n).then((function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,c=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(c)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return In(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?In(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),n=e[0],r=(e[1],n.getViewport({scale:_n.scale,rotation:_n.rotate}));Cn=r.height}))}))}document.getElementById("content-wrapper").addEventListener("scroll",(function(t){var e=Math.round(t.target.scrollTop/Cn)+1,n=document.querySelector('.page[data-page-number="'.concat(e,'"][data-loaded="false"]'));-1===Nn.indexOf(e)?(Pn=!0,Nn.push(e)):Pn=!1,n&&Pn&&setTimeout((function(){Ln.renderPage(e,_n)}))})),jn(),function(){var t,e,n;function r(n,r){var o=!1;if(t!==n&&(o=!0,t=n,localStorage.setItem("".concat(_n.documentId,"/text/size"),t),document.querySelector(".toolbar .text-size").value=t),e!==r){o=!0,e=r,localStorage.setItem("".concat(_n.documentId,"/text/color"),e);var i=document.querySelector(".toolbar .text-color.color-selected");i&&(i.classList.remove("color-selected"),i.removeAttribute("aria-selected")),(i=document.querySelector('.toolbar .text-color[data-color="'.concat(r,'"]')))&&(i.classList.add("color-selected"),i.setAttribute("aria-selected",!0))}o&&Ln.setText(t,e)}document.querySelector(".toolbar .text-size").addEventListener("change",(function(t){r(t.target.value,e)})),n=document.querySelector(".toolbar .text-size"),[8,9,10,11,12,14,18,24,30,36,48,60,72,96].forEach((function(t){n.appendChild(new Option(t,t))})),r(localStorage.getItem("".concat(_n.documentId,"/text/size"))||10,localStorage.getItem("".concat(_n.documentId,"/text/color"))||"#000000"),En(document.querySelector(".text-color"),e,(function(e){r(t,e)}))}(),function(){var t,e;function n(n,r){var o=!1;if(t!==n&&(o=!0,t=n,localStorage.setItem("".concat(_n.documentId,"/pen/size"),t),document.querySelector(".toolbar .pen-size").value=t),e!==r){o=!0,e=r,localStorage.setItem("".concat(_n.documentId,"/pen/color"),e);var i=document.querySelector(".toolbar .pen-color.color-selected");i&&(i.classList.remove("color-selected"),i.removeAttribute("aria-selected")),(i=document.querySelector('.toolbar .pen-color[data-color="'.concat(r,'"]')))&&(i.classList.add("color-selected"),i.setAttribute("aria-selected",!0))}o&&Ln.setPen(t,e)}document.querySelector(".toolbar .pen-size").addEventListener("change",(function(t){n(t.target.value,e)})),function(){for(var r=document.querySelector(".toolbar .pen-size"),o=0;o<20;o++)r.appendChild(new Option(o+1,o+1));n(localStorage.getItem("".concat(_n.documentId,"/pen/size"))||1,localStorage.getItem("".concat(_n.documentId,"/pen/color"))||"#000000"),En(document.querySelector(".pen-color"),e,(function(e){n(t,e)}))}()}(),function(){var t=localStorage.getItem("".concat(_n.documentId,"/tooltype"))||"cursor";function e(e,n){var r=document.querySelector(".toolbar button.active");if(r)switch(r.classList.remove("active"),t){case"cursor":Ln.disableEdit();break;case"eraser":Ln.disableEraser();break;case"draw":Ln.disablePen();break;case"arrow":Ln.disableArrow();break;case"text":Ln.disableText();break;case"point":Ln.disablePoint();break;case"area":case"highlight":case"strikeout":Ln.disableRect();break;case"circle":case"emptycircle":case"fillcircle":Ln.disableCircle();break;case"select":Ln.enableUI()}switch(n&&n.classList.add("active"),t!==e&&localStorage.setItem("".concat(_n.documentId,"/tooltype"),e),t=e,e){case"cursor":Ln.enableEdit();break;case"eraser":Ln.enableEraser();break;case"draw":Ln.enablePen();break;case"arrow":Ln.enableArrow();break;case"text":Ln.enableText();break;case"point":Ln.enablePoint();break;case"area":case"highlight":case"strikeout":Ln.enableRect(e);break;case"circle":case"emptycircle":case"fillcircle":Ln.enableCircle(e);break;case"select":Ln.disableUI()}}t&&e(t,document.querySelector(".toolbar button[data-tooltype=".concat(t,"]"))),document.querySelector(".toolbar").addEventListener("click",(function(t){"BUTTON"===t.target.nodeName&&e(t.target.getAttribute("data-tooltype"),t.target)}))}(),document.querySelector(".toolbar select.scale").value=_n.scale,document.querySelector(".toolbar select.scale").addEventListener("change",(function(t){!function(t,e){t=parseFloat(t,10),e=parseInt(e,10),_n.scale===t&&_n.rotate===e||(_n.scale=t,_n.rotate=e,localStorage.setItem("".concat(_n.documentId,"/scale"),_n.scale),localStorage.setItem("".concat(_n.documentId,"/rotate"),_n.rotate%360),jn())}(t.target.value,_n.rotate)})),document.querySelector("a.clear").addEventListener("click",(function(t){if(window.confirm("Are you sure you want to clear annotations?")){for(var e=0;e<On;e++)document.querySelector("div#pageContainer".concat(e+1," svg.annotationLayer")).innerHTML="";localStorage.removeItem("".concat(_n.documentId,"/annotations")),xn.getStoreAdapter().clearHistory(_n.documentId)}})),function(){function t(t){var e=t.target.getAttribute("data-tooltype");"undo"===e?xn.getStoreAdapter().undo(_n.documentId).then((function(){for(var t=1;t<=On;t+=1)Ln.rerenderAnnotations(t,_n)})):"redo"===e?xn.getStoreAdapter().redo(_n.documentId).then((function(){for(var t=1;t<=On;t+=1)Ln.rerenderAnnotations(t,_n)})):"clear_history"===e&&window.confirm("Clear history? This operation cannot be undone.")&&xn.getStoreAdapter().clearHistory(_n.documentId)}document.querySelector("a.undo").addEventListener("click",t),document.querySelector("a.redo").addEventListener("click",t)}(),function(t,e){var n=e.querySelector("#comment-wrapper .comment-list-container"),r=e.querySelector("#comment-wrapper .comment-list-form"),o=r.querySelector('input[type="text"]');function i(t){var e=t.getAttribute("data-pdf-annotate-type");return["point","highlight","area"].indexOf(e)>-1}function a(t){var r=e.createElement("div");r.className="comment-list-item",r.innerHTML=t.content.replace("&","&amp;").replace(">","&gt;").replace("<","&lt;").replace('"',"&quot;").replace("'","&#39;"),n.appendChild(r)}Ln.addEventListener("annotation:click",(function(t){if(i(t)){var e=t.parentNode.getAttribute("data-pdf-annotate-document"),c=t.getAttribute("data-pdf-annotate-id");xn.getStoreAdapter().getComments(e,c).then((function(t){n.innerHTML="",r.style.display="",o.focus(),r.onsubmit=function(){return xn.getStoreAdapter().addComment(e,c,o.value.trim()).then(a).then((function(){o.value="",o.focus()})),!1},t.forEach(a)}))}})),Ln.addEventListener("annotation:blur",(function(t){i(t)&&(n.innerHTML="",r.style.display="none",r.onsubmit=null,a({content:"No comments"}))})),Ln.setArrow(10,"darkgoldenrod"),Ln.setCircle(10,"darkgoldenrod")}(window,document)})(),r})()));
//# sourceMappingURL=index.js.map